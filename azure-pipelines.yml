# Node.js
# Build a general Node.js project with npm.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

trigger:
  branches:
    include:
      - main  # Adjust if needed

pool:
  vmImage: 'ubuntu-latest'

steps:
  - checkout: self  # Check out the API repo

  - task: UseNode@1
    inputs:
      version: '18'  # Adjust Node.js version if needed

  - script: |
      npm install
    displayName: "Install Dependencies"

  - script: |
      npm run start &
    displayName: "Start API Server in Background"

  - script: |
      sleep 5
    displayName: "Wait for API Server to Start"

  - script: |
      if [ -d "tests" ]; then rm -rf tests; fi  # Remove existing 'tests' directory if it exists
      git clone https://github.com/YOUR-USERNAME/YOUR-PLAYWRIGHT-REPO.git tests
    displayName: "Clone Playwright Tests Repo"

  - script: |
      npm install
    workingDirectory: tests
    displayName: "Install Playwright Dependencies"

  - script: |
      npx playwright test
    workingDirectory: tests
    displayName: "Run Playwright API Tests"

  - task: PublishBuildArtifacts@1
    inputs:
      pathToPublish: tests/playwright-report/
      artifactName: playwright-results
    displayName: "Upload Test Results"

